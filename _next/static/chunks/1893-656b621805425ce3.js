"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1893],{1893:function(t,e,i){i.d(e,{y9:function(){return n},poolFormStore:function(){return K}});var s,n,o=i(8590),r=i(8179),d=i(98530),a=i(59533),l=i(24594),u=i(94522),h=i(5515),m=i(28066),p=i(26056),c=i(90818),g=i(64719),f=i(39552),A=i(31174),y=i(35153),v=i(52805),w=i(15322),T=i(21518),b=i(86592),S=i(33221),x=i(48540),D=i(50671),Z=i(41216),O=i(41270);let P=O.ZP.object({action:O.ZP.enum(["deposit","redeem"]),dstAddress:O.ZP.string(),srcAddress:O.ZP.string(),dstAmount:O.ZP.string(),srcAmount:O.ZP.string(),mode:O.ZP.string().optional(),srcChain:O.ZP.string().optional(),dstChain:O.ZP.string().optional(),pool:O.ZP.string(),stargateVersion:O.ZP.string(),status:O.ZP.enum(["success","error"]),srcTxTimestamp:O.ZP.number(),srcTxHash:O.ZP.string(),error:O.ZP.string(),errorCode:O.ZP.string()}).partial();async function C(t){let e=P.parse(t);return(0,Z.j)("pool",e)}async function k(){return[{type:"withdraw"}]}async function E(t){let{allowance:e,amount:i}=t,s=[];return e.lessThan(i)&&s.push({type:"approve"}),s.push({type:"deposit"}),s}let H={arbitrum:10000000n,avalanche:25000000001n,base:4828789n,bsc:1000000000n,ethereum:4617725379n,fantom:24872154916n,kava:1000000000n,linea:113674727n,mantle:20000000n,metis:1247735823n,optimism:2064256n,polygon:30007728957n,scroll:52147260n,aurora:70000000n,sei:100000000000n,lightlink:120000000n},W={arbitrum:76159n,avalanche:53793n,base:53793n,bsc:53000n,ethereum:53000n,fantom:53000n,kava:53000n,linea:53793n,mantle:286811167n,metis:53000n,optimism:53793n,polygon:53000n,scroll:53000n,aurora:70666n,sei:53793n,lightlink:122177n};var B=i(15139);(s=n||(n={})).DEPOSIT="DEPOSIT",s.WITHDRAW="WITHDRAW";class I{get isLoading(){var t,e;return null!==(e=null===(t=this.promises.redeemOptions)||void 0===t?void 0:t.case({pending:()=>!0,rejected:()=>!1,fulfilled:t=>!1===t.done}))&&void 0!==e&&e}get adapter(){let{pool:t}=this;if(t){for(let e of B.b.adapters)if(e.supportsPool(t))return e}}get wallet(){return g.walletStore.evm}get errors(){let{wallet:t,amount:e,maxAmount:i,pool:s,adapter:n}=this,o=[];function r(t){o.push(t)}if("DEPOSIT"===this.form.mode){var d;(null===(d=this.pool)||void 0===d?void 0:d.disabled)&&r("Pool is disabled")}return t||r("Connect wallet"),s?n||r("Pool not supported"):r("Select pool"),e&&e.greaterThan(0)||r("Enter amount"),i&&e&&e.greaterThan(i)&&r("Amount exceeds balance"),o}get mode(){return this.form.mode}get depositAmount(){let{pool:t}=this;if(!t)return;let e=(0,o.sp)(t.token,this.form.amount);if(e)return(0,o.LA)(e,t.sharedDecimals)}get withdrawAmount(){if(this.pool)return(0,o.sp)(this.pool.lpToken,this.form.amount)}get amount(){return"DEPOSIT"===this.form.mode?this.depositAmount:this.withdrawAmount}get maxAmount(){return"DEPOSIT"===this.form.mode?this.maxDepositAmount:this.maxWithdrawAmount}get tokenBalance(){if(this.pool&&this.wallet)return this.balanceStore.getBalance(this.pool.token,this.wallet.address)}get maxDepositAmount(){let{tokenBalance:t}=this;if(t){if((0,o.iI)(t.token)){let e=function(t){var e,i;let s=null!==(e=H[t.chainKey])&&void 0!==e?e:20000000000n,n=null!==(i=W[t.chainKey])&&void 0!==i?i:60000n;return o.ih.fromBigInt(t,s*n*4n)}(t.token);if(e)return t.greaterThan(e)?t.subtract(e):t.multiply(0)}return t}}get maxWithdrawAmount(){if(this.pool&&this.wallet)return p._.getBalance(this.pool.lpToken,this.wallet.address)}get liquidityMinted(){return(0,A.d)(this.promises.liquidityMinted)}get depositedAmount(){return(0,A.d)(this.promises.depositedAmount)}get allRedeemOptions(){var t;return null===(t=(0,A.d)(this.promises.redeemOptions))||void 0===t?void 0:t.value}get enabledRedeemOptions(){let{allRedeemOptions:t,pool:e}=this;if(!t||!e)return;let i=this.heuristics.find(t=>t.supports(e)),s=null==i?void 0:i.filter(t);return(null!=s?s:t).slice().sort((t,e)=>M(e)-M(t))}setMode(t){this.form.mode=t}setAmount(t){this.form.amount=t}setMaxAmount(){let{maxAmount:t}=this;if(!t)throw Error("maxAmount is undefined");this.form.amount=t.toExact()}setPool(t){this.pool!==t&&(this.promises.liquidityMinted=void 0,this.pool=t)}get srcAddress(){var t;return null===(t=this.wallet)||void 0===t?void 0:t.address}get dstAddress(){return this.srcAddress}close(){this.modals.confirmation=!1,this.modals.redeemOptions=!1}updateRedeemOptions(){let{adapter:t,amount:e,srcAddress:i,dstAddress:s}=this;(0,r.Z)(t,"adapter is undefined"),(0,r.Z)(e,"amount is undefined"),(0,r.Z)(i,"wallet not connected"),(0,r.Z)(s,"wallet not connected");let n=t.getRedeemOptions({amount:e,srcAddress:i,dstAddress:s});return this.promises.redeemOptions=(0,l.p4)(n.then(t=>(function(t){let e=a.LO.array([],{deep:!1}),i=(0,a.LO)({value:e,done:!1});return async function(){for await(let i of t)e.push(i);i.done=!0}(),i})(t))),n}async updateDepositedAmount(){let{adapter:t,wallet:e,pool:i}=this;if(this.promises.depositedAmount=void 0,!t||!e||!i)return;let s=this.balanceStore.updateBalance(i.lpToken,e.address).then(e=>t.getDepositedAmount({amount:e}));return this.promises.depositedAmount=(0,l.p4)(s),s}async updateBalances(){let{wallet:t,pool:e}=this;if(t&&e)return Promise.all([this.balanceStore.updateBalance(e.token,t.address),this.balanceStore.updateBalance(e.lpToken,t.address)])}async updateLiquidityMinted(){let{adapter:t,pool:e,depositAmount:i}=this;if(this.promises.liquidityMinted=void 0,!t||!e||!i)return;let s=t.getLiquidityMinted({amount:i});return this.promises.liquidityMinted=(0,l.p4)(s),s}connectWallet(){c.uiStore.accountSlideIn.open()}subscribe(){let t=()=>{let{wallet:t,pool:e}=this;this.updateBalances()},e=()=>{let{adapter:t,pool:e,depositAmount:i}=this;this.updateLiquidityMinted()},i=()=>{let{adapter:t,wallet:e,pool:i}=this;this.updateDepositedAmount()},s=[(0,a.EH)(()=>i()),(0,a.EH)(()=>t()),(0,a.EH)(()=>e())];return()=>{s.forEach(t=>t())}}constructor(){this.balanceStore=p._,this.poolStore=B.b,this.heuristics=a.LO.array(u.Wo,{deep:!1}),this.pool=void 0,this.form={amount:"",mode:"DEPOSIT"},this.selectedOption=void 0,this.promises={liquidityMinted:void 0,depositedAmount:void 0,redeemOptions:void 0},this.modals={confirmation:!1,redeemOptions:!1},this.isConfirming=!1,this.isExecuting=!1,this.isWithdrawing=!1,this.isDepositing=!1,this.isApproving=!1,this.isSigning=!1,this.steps=[],this.deposit=(0,a.ls)((function*(){let t=L(this,"deposit"),{depositAmount:e,wallet:i,adapter:s,pool:n,srcAddress:o,liquidityMinted:a}=this;(0,r.Z)(n,"pool is undefined"),(0,r.Z)(e,"amount is undefined"),(0,r.Z)(i,"wallet is undefined"),(0,r.Z)(o,"wallet is undefined"),(0,r.Z)(s,"adapter is undefined"),(0,r.Z)(a,"liquidityMinted is undefined");try{this.isExecuting=!0,this.isDepositing=!0;let r=yield s.getAllowance({account:i.address});if(this.steps=yield E({allowance:r,amount:e}),yield i.switchChain(n.chainKey),yield(0,d.TD)(i,{chainKey:n.chainKey,address:o}),r.lessThan(e)){let t={account:i.address,amount:(0,y.y)(e)},n=yield s.approve(t);this.isApproving=!0;let o=yield i.signAndSubmit(n);this.isConfirming=!0,yield o.wait(),this.isConfirming=!1,this.isApproving=!1,m.actionStore.addAction(h.R.create({txHash:o.txHash,amount:t.amount,createdTimestamp:(0,w.u3)()}))}let l={amount:e,srcAddress:o,dstAddress:o};yield(0,d.TD)(i,{chainKey:n.chainKey,address:o});let u=yield s.deposit(l);this.isSigning=!0;let p=yield i.signAndSubmit(u);this.isSigning=!1,this.isConfirming=!0;let c=yield p.wait();this.isConfirming=!1,this.setAmount("");let g=T.k.create({createdTimestamp:(0,w.u3)(),dstAddress:l.dstAddress,srcAddress:l.srcAddress,dstAmount:a,srcAmount:e,txHash:c.txHash});C({...t,status:"success",srcTxHash:c.txHash,srcTxTimestamp:(0,w.u3)()}),m.actionStore.addAction(g)}catch(e){throw(0,x.S)(e,()=>{let{message:i,title:s}=(0,D.B)(e);C({...t,status:"error",srcTxTimestamp:(0,w.u3)(),error:s,errorCode:i.substring(0,256)})}),e}finally{this.steps=[],this.isConfirming=!1,this.isExecuting=!1,this.isSigning=!1,this.isApproving=!1,this.isDepositing=!1,this.updateBalances()}}).bind(this)),this.redeem=(0,a.ls)(function*(t){let e=L(this,"redeem");this.modals.redeemOptions=!1,this.selectedOption=t,this.isExecuting=!0;let{wallet:i,adapter:s,pool:n,srcAddress:o,dstAddress:d}=this;(0,r.Z)(i,"wallet is undefined"),(0,r.Z)(s,"adapter is undefined"),(0,r.Z)(n,"pool is undefined"),(0,r.Z)(t,"option is undefined"),(0,r.Z)(o,"srcAddress is undefined"),(0,r.Z)(d,"dstAddress is undefined");try{this.isExecuting=!0,this.isWithdrawing=!0,this.steps=yield k();let n=t.createInput({srcAddress:o,dstAddress:d}),r=n.srcAmount.token.chainKey,a=n.dstAmount.token.chainKey;yield(0,f.b)(i,a),yield i.switchChain(r);let l=yield s.redeem(n);this.isSigning=!0;let u=yield i.signAndSubmit(l);this.isSigning=!1,this.isConfirming=!0;let h=yield u.wait();this.isConfirming=!1,this.setAmount("");let p=n.mode===S.Ki.LOCAL||n.mode===S.Ki.REMOTE,c=b.z.create({createdTimestamp:(0,w.u3)(),dstAddress:n.dstAddress,srcAddress:n.srcAddress,srcAmount:n.srcAmount,dstAmount:n.dstAmount,mode:n.mode,txHash:h.txHash,chainKey:r,...p&&{srcTxHash:h.txHash,srcChainKey:r,dstChainKey:a}});C({...e,status:"success",srcTxHash:h.txHash,srcTxTimestamp:(0,w.u3)(),mode:n.mode,srcChain:r,dstChain:a}),m.actionStore.addAction(c)}catch(t){throw(0,x.S)(t,()=>{let{message:i,title:s}=(0,D.B)(t);C({...e,status:"error",srcTxTimestamp:(0,w.u3)(),error:s,errorCode:i.substring(0,256)})}),t}finally{this.steps=[],this.isConfirming=!1,this.isExecuting=!1,this.isSigning=!1,this.isApproving=!1,this.isWithdrawing=!1,this.selectedOption=void 0,this.updateBalances(),this.updateDepositedAmount()}}),this.showWithdrawOptions=()=>{this.updateRedeemOptions(),this.modals.redeemOptions=!0},(0,a.ky)(this,{form:!0,pool:a.LO.ref,errors:a.Fl.struct,setAmount:a.aD.bound,amount:a.Fl.struct,maxAmount:a.Fl.struct,tokenBalance:a.Fl.struct,wallet:!0,liquidityMinted:a.Fl.struct,adapter:a.Fl,isConfirming:!0,isExecuting:!0,isWithdrawing:!0,isDepositing:!0,isApproving:!0,isSigning:!0,isLoading:a.Fl,updateDepositedAmount:a.aD.bound,updateBalances:a.aD.bound,updateLiquidityMinted:a.aD.bound,setMaxAmount:a.aD.bound,setPool:a.aD.bound,setMode:a.aD.bound,deposit:a.ls,redeem:a.ls},{autoBind:!0})}}let K=new I;function M(t){var e,i;return(null!==(e=(0,v.W)(t.dstAmount))&&void 0!==e?e:0)-(null!==(i=(0,v.W)(t.fee.nativeFee))&&void 0!==i?i:0)}function L(t,e){var i,s;let{srcAddress:n,liquidityMinted:o,depositAmount:r,pool:d,selectedOption:a,mode:l}=t;return{action:e,dstAddress:n,srcAddress:n,srcAmount:"WITHDRAW"===l?null==a?void 0:a.srcAmount.toBigInt().toString():null==r?void 0:r.toBigInt().toString(),dstAmount:"WITHDRAW"===l?null==a?void 0:null===(i=a.dstAmount)||void 0===i?void 0:i.toBigInt().toString():null==o?void 0:o.toBigInt().toString(),srcChain:null==d?void 0:d.chainKey,dstChain:"WITHDRAW"===l?null==a?void 0:null===(s=a.dstAmount)||void 0===s?void 0:s.token.chainKey:null==d?void 0:d.chainKey,pool:null==d?void 0:d.address,stargateVersion:null==d?void 0:d.stargateVersion}}}}]);