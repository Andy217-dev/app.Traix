"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4522],{94522:function(t,e,n){n.d(e,{p3:function(){return td},aL:function(){return tl},Gm:function(){return ta},S1:function(){return ts},Wo:function(){return tc},Sl:function(){return tu}});var r,i,o,a,s=n(8590),c=n(80417),d=n(95836),l=n(76908),u=n(12728),h=n(49808),m=n(93465),p=n(51436);class y{async getRewards(t){return{tokens:this.farm.rewards}}async approve(t){return this.erc20.forToken(t.amount.token).approve(t.amount,this.farm.address)}async getAllowance(t){return this.erc20.forToken(this.farm.lpToken).allowance(t.owner,this.farm.address)}async getDepositedAmount(t){let e=this.getContract(),n=await e.userInfo(this.farm.pid,t.user);return{user:t.user,farm:this.farm,amount:s.ih.fromBigInt(this.farm.lpToken,n.amount.toBigInt())}}supports(t){return this.farm.address===t.address&&this.farm.chainKey===t.chainKey&&"pid"in t&&t.pid===this.farm.pid}async getPendingRewards(t){var e;if(e=this.farm,g.some(t=>t.chainKey===e.chainKey&&t.address.toLowerCase()===e.address.toLowerCase()))return{user:t.user,farm:this.farm,rewards:[]};let n=this.getContract(),r="eTokenPerSecond"in n?await n.pendingEmissionToken(this.farm.pid,t.user):await n.pendingStargate(this.farm.pid,t.user),[i]=this.farm.rewards,o=s.ih.fromBigInt(i,r.toBigInt());return{user:t.user,farm:this.farm,rewards:[o]}}async claim(t){let e=this.getContract(),n=await e.populateTransaction.deposit(this.farm.pid,0);return(0,m._X)(n,{provider:e.provider,chainKey:this.farm.chainKey})}async deposit(t){let e=this.getContract(),n=t.amount.quotient,r=this.farm.pid,i=e.populateTransaction.deposit(r,n);return(0,m._X)(i,{provider:e.provider,chainKey:this.farm.chainKey})}async withdraw(t){let e=this.getContract(),n=t.amount.quotient,r=await e.populateTransaction.withdraw(this.farm.pid,n);return(0,m._X)(r,{provider:e.provider,chainKey:this.farm.chainKey})}async emergencyWithdraw(){let t=this.getContract(),e=await t.populateTransaction.emergencyWithdraw(this.farm.pid);return(0,m._X)(e,{provider:t.provider,chainKey:this.farm.chainKey})}getContract(){let t=this.providerFactory(this.farm.chainKey);if("lpStaking"===this.farm.type)return p.K6.connect(this.farm.address,t);if("lpStakingTime"===this.farm.type)return p.pQ.connect(this.farm.address,t);throw Error("Unsupported farm type")}constructor(t,e,n){this.farm=t,this.providerFactory=e,this.erc20=n}}let g=[{chainKey:"optimism",address:"0x4a364f8c717cAAD9A442737Eb7b8A55cc6cf18D8"}];var f=n(51502);let w="0x0000000000000000000000000000000000000000";class I{async getRewards(t){let e=this.getRewarderContract(this.farm.chainKey),n=await e.rewardTokens();return{tokens:await Promise.all(n.map(t=>this.getToken({address:t,chainKey:this.farm.chainKey})))}}async getAllowance(t){return this.erc20.forToken(this.farm.lpToken).allowance(t.owner,this.stakingContract.address)}async approve(t){return this.erc20.forToken(this.farm.lpToken).approve(t.amount,this.stakingContract.address)}supports(t){return t===this.farm||t.address===this.farm.address&&t.chainKey===this.farm.chainKey&&t.lpToken.equals(this.farm.lpToken)}async getPendingRewards(t){let e=this.getTokenAddress(this.farm.lpToken),[n,r]=await this.rewarderContract.getRewards(e,t.user),i=await Promise.all(n.map(async(t,e)=>{let n=r[e].toBigInt(),i=await this.getCurrencyByAddress(t);return s.ih.fromBigInt(i,n)}));return{farm:this.farm,user:t.user,rewards:i}}async getDepositedAmount(t){let e=this.getTokenAddress(this.farm.lpToken),n=await this.stakingContract.balanceOf(e,t.user),r=s.ih.fromBigInt(this.farm.lpToken,n.toBigInt());return{farm:this.farm,user:t.user,amount:r}}async claim(t){let e=this.farm.chainKey,n=[this.farm.lpToken.address],r=this.stakingContract.populateTransaction.claim(n),i=this.providerFactory(e);return(0,m._X)(r,{provider:i,chainKey:e})}async deposit(t){let e=this.farm.chainKey,n=this.getTokenAddress(this.farm.lpToken),r=t.amount.toBigInt(),i=this.stakingContract.populateTransaction.deposit(n,r),o=this.providerFactory(e);return(0,m._X)(i,{provider:o,chainKey:e})}async withdraw(t){let e=this.farm.chainKey,n=this.getTokenAddress(this.farm.lpToken),r=t.amount.toBigInt(),i=this.stakingContract.populateTransaction.withdraw(n,r),o=this.providerFactory(e);return(0,m._X)(i,{provider:o,chainKey:e})}async getToken(t){return this.isNativeAddress(t.address)?(0,s.JK)(t.chainKey):this.erc20.getToken(t)}getTokenAddress(t){return(0,s.hD)(t)?t.address:w}tryGetDeployment(t){return this.config.deployments[t]}getDeployment(t){let e=this.tryGetDeployment(t);if(e)return e;throw Error("Deployment not found for chainKey: ".concat(t))}getStakingContract(t){let e=this.getDeployment(t),n=this.providerFactory(t);return f.X0.connect(e.stargateStaking.address,n)}getRewarderContract(t){let e=this.getDeployment(t),n=this.providerFactory(t);return f.eT.connect(e.stargateMultiRewarder.address,n)}isNativeAddress(t){return t.toLowerCase()===w.toLowerCase()}async getCurrencyByAddress(t){return this.isNativeAddress(t)?(0,s.JK)(this.farm.chainKey):this.erc20.getToken({chainKey:this.farm.chainKey,address:t})}constructor(t,e,n,r=new m.gp(n)){this.farm=t,this.config=e,this.providerFactory=n,this.erc20=r,this.stakingContract=this.getStakingContract(this.farm.chainKey),this.rewarderContract=this.getRewarderContract(this.farm.chainKey)}}var T=n(33221),A=n(3566),k=n(52805),v=n(82805),K=n(84979);class C{supports(t){return t.stargateVersion===A.C.V1}filter(t){return t.filter(t=>this.isValidOption(t))}isValidOption(t){if(t.dstAmount.lessThanOrEqualTo(0))return!1;if(t instanceof v.P){var e;if((null!==(e=(0,k.W)(t.dstAmount))&&void 0!==e?e:Number.POSITIVE_INFINITY)>this.config.instant.usdLimit)return!1}return!(t instanceof K.H&&t.meta.remoteChainPathBalanceToIdealBalanceAfterRedeem.lessThan(this.config.local.minRemoteChainPathBalanceToIdealBalanceRatio))}constructor(t){this.config=t}}var R=n(32489),F=n(59825),B=n(8643);class D{static create(t){return new D(t)}createInput(t){return{mode:this.mode,srcAmount:this.srcAmount,dstAmount:this.dstAmount,srcAddress:t.srcAddress,dstAddress:t.dstAddress}}constructor(t){this.mode=o.INSTANT,this.srcAmount=t.srcAmount,this.dstAmount=t.dstAmount,this.fee=t.fee,this.meta=t.meta,this.estimatedDuration=t.estimatedDuration}}class q{static create(t){return new q(t)}createInput(t){return{mode:this.mode,srcAmount:this.srcAmount,dstAmount:this.dstAmount,srcAddress:t.srcAddress,dstAddress:t.dstAddress,fee:this.fee}}constructor(t){this.mode=o.REMOTE,this.srcAmount=t.srcAmount,this.dstAmount=t.dstAmount,this.fee=t.fee,this.meta=t.meta,this.estimatedDuration=t.estimatedDuration}}(r=o||(o={})).INSTANT="instant",r.REMOTE="remote";class L{supportsPool(t){return t.address===this.pool.address&&t.chainKey===this.pool.chainKey}async getTotalSupply(){return this.erc20.forToken(this.pool.lpToken).totalSupply()}async getBalance(t){return this.erc20.forToken(this.pool.lpToken).balanceOf(t.account)}async deposit(t){let e=this.providerFactory(this.pool.chainKey),n=this.getPoolContract(),r=(0,s.iI)(t.amount.token)?t.amount.quotient:void 0,i=n.populateTransaction.deposit(t.dstAddress,t.amount.quotient,{from:t.srcAddress,value:r});return(0,m._X)(i,{provider:e,chainKey:this.pool.chainKey})}redeem(t){if("remote"===t.mode)return this.redeemRemote(t);if("instant"===t.mode)return this.redeemInstant(t);throw Error("Invalid option ".concat(t.mode))}async redeemInstant(t){let e=this.getPoolContract(),n=t.srcAddress,r=await e.populateTransaction.redeem(t.srcAmount.quotient,t.dstAddress,{from:n});return(0,m._X)(r,{provider:e.provider,chainKey:this.pool.chainKey})}async redeemRemote(t){let e=this.getPoolContract(),n=t.dstAmount.token.chainKey,r=(0,s.ph)(t.dstAmount,t.srcAmount.token),i=new c.oL(c.zv.TAXI,[]),o=t.srcAddress,a=t.srcAddress,d=(0,s.fs)(t.dstAddress,(0,s.H1)(n)),l={amountLD:t.srcAmount.toBigInt(),to:R.Dv(d),dstEid:this.chainKeyToEid(n),composeMsg:"0x",extraOptions:"0x",minAmountLD:r.toBigInt(),oftCmd:i.toBytes()},u=await e.quoteRedeemSend(l,!1).then(t=>({nativeFee:t.nativeFee.toBigInt(),lzTokenFee:t.lzTokenFee.toBigInt()})),h={nativeFee:t.fee.nativeFee.toBigInt(),lzTokenFee:t.fee.zroFee.toBigInt()};if(u.nativeFee>h.nativeFee)throw Error("Fee changed");let p=t.fee.nativeFee.toBigInt(),y=await e.populateTransaction.redeemSend(l,h,a,{value:p,from:o});return(0,m._X)(y,{provider:e.provider,chainKey:this.pool.chainKey})}async getLiquidityMinted(t){let e=(0,s.LA)(t.amount,this.pool.sharedDecimals);return(0,s.ph)(e,this.pool.lpToken)}async getDepositedAmount(t){return(0,s.ph)(t.amount,this.pool.token)}async getRedeemOptions(t){let[e,n]=await Promise.all([this.getRedeemLiquidityOptionsInstant(t),this.getRedeemLiquidityOptionsRemote(t)]);return(0,B.y)([e,n])}async getRedeemLiquidityOptionsInstant(t){var e,n,r;let i=this.getPoolContract(),o=(n=(await i.redeemable(null!==(e=t.srcAddress)&&void 0!==e?e:m.dE)).toBigInt())<(r=t.amount.toBigInt())?n:r,a=s.ih.fromBigInt(this.pool.lpToken,o),c=s.ih.fromBigInt(this.pool.token,o),d=s.v7.from(this.pool.chainKey,{nativeFee:0,zroFee:0}),l=D.create({dstAmount:c,srcAmount:a,fee:d,estimatedDuration:1,meta:{}});return(0,B.C)([l])}async getRedeemLiquidityOptionsRemote(t){let e=[];for(let t in this.config.deployments)t!==this.pool.chainKey&&e.push(t);return(0,B.C)(e.map(e=>this.getRedeemLiquidityOptionRemote({...t,dstChainKey:e})))}async getRedeemLiquidityOptionRemote(t){let e=c.zv.TAXI,n=new c.oL(e,[]),r=t.amount.token,i=t.dstChainKey,o=this.getDeployment(i).token,a=r.chainKey,d=t.amount,l=(0,s.ME)(r,"0"),u=m.IP,h=(0,s.fs)(u,(0,s.H1)(i)),p={amountLD:d.toBigInt(),to:R.Dv(h),dstEid:this.chainKeyToEid(i),composeMsg:"0x",extraOptions:"0x",minAmountLD:l.toBigInt(),oftCmd:n.toBytes()},y=this.getPoolContract(),[g,f]=await Promise.all([y.quoteOFT(p),y.quoteRedeemSend(p,!1)]),w=s.ih.fromBigInt(r,g.receipt.amountSentLD.toBigInt()),I=s.ih.fromBigInt(r,g.receipt.amountReceivedLD.toBigInt()),T=(0,s.ph)(I,o),A=await F.k.getDuration({srcChainKey:a,dstChainKey:i});return q.create({srcAmount:w,dstAmount:T,fee:s.v7.from(a,{nativeFee:f.nativeFee.toBigInt(),zroFee:f.lzTokenFee.toBigInt()}),estimatedDuration:A,meta:{}})}async getAllowance(t){let e=this.getDeployment(this.pool.chainKey);if((0,s.iI)(e.token))return s.ih.fromBigInt(e.token,s.Bz);let n=t.account,r=this.pool.address;return this.erc20.forToken(e.token).allowance(n,r)}approve(t){let e=this.pool.address;return this.erc20.forToken(this.pool.token).approve(t.amount,e)}tryGetDeployment(t){var e;return null===(e=this.config)||void 0===e?void 0:e.deployments[t]}getDeployment(t){let e=this.tryGetDeployment(t);if(e)return e;throw Error("Deployment not found for chainKey: ".concat(t))}chainKeyToEid(t){return this.getDeployment(t).eid}getPoolContract(){return f.DC.connect(this.pool.address,this.providerFactory(this.pool.chainKey))}constructor(t,e,n,r=new m.gp(n)){this.pool=t,this.config=e,this.providerFactory=n,this.erc20=r}}class P{supports(t){return t.stargateVersion===A.C.V2}filter(t){return t.filter(t=>this.isValidOption(t))}isValidOption(t){return!t.dstAmount.lessThanOrEqualTo(0)}constructor(t){this.config=t}}var E=n(8179);(i=a||(a={})).FEE_DISTRIBUTOR="FEE_DISTRIBUTOR",i.MERKLE_DROP="MERKLE_DROP";class b{supportsClaim(t){return this.config.feeDistributor.address===t.rewardDistributor.address&&this.config.chainKey===t.rewardDistributor.chainKey}async getMaxUserEpoch(t){let e=this.getVotingEscrowContract();return(await e.user_point_epoch(t)).toNumber()}async isUserEligible(t){return 0!==await this.getMaxUserEpoch(t)}createStakingReward(t,e){return{type:a.FEE_DISTRIBUTOR,rewardDistributor:{address:this.config.feeDistributor.address,chainKey:this.config.chainKey},user:t,pendingRewards:e}}async getPendingRewards(t){if(!await this.isUserEligible(t))return[];try{let e=await this.getPendingFees(t);return[this.createStakingReward(t,e)]}catch(t){return[]}}async getPendingFees(t){let e=this.getFeeDistributorContract(),n=this.config.rewardTokens;return(await e.callStatic.claimTokens(t,n.map(t=>t.address))).map((t,e)=>{let r=n[e];return(0,E.Z)(r,"token"),s.ih.fromBigInt(r,t.toBigInt())})}async claim(t){let e=this.providerFactory(this.config.chainKey),n=this.getFeeDistributorContract(),r=this.config.rewardTokens.map(t=>t.address),i=t.user,o=n.populateTransaction.claimTokens(i,r);return(0,m._X)(o,{provider:e,chainKey:this.config.chainKey})}getVotingEscrowContract(){return p.PN.connect(this.config.votingEscrow.address,this.providerFactory(this.config.chainKey))}getFeeDistributorContract(){return p.Ye.connect(this.config.feeDistributor.address,this.providerFactory(this.config.chainKey))}constructor(t,e){this.config=t,this.providerFactory=e}}var O=n(41270),S=n(8189);let _=O.z.object({user:O.z.string(),rewardDistributor:O.z.object({address:O.z.string(),chainKey:O.z.string()}),pendingRewards:O.z.array(s.k1),type:O.z.literal(a.MERKLE_DROP),claimedAmount:s.k1,accumulatedAmount:s.k1,proof:O.z.array(O.z.string())});class N{supportsClaim(t){return _.safeParse(t).success}async claim(t){let{chainKey:e,address:n}=t.rewardDistributor,r=this.providerFactory(e),i=p.fg.connect(n,r).populateTransaction.redeemFees(t.user,t.accumulatedAmount.toBigInt(),t.proof);return(0,m._X)(i,{provider:r,chainKey:e})}async getPendingRewards(t){let e=await S.u.stake.merkleDropV2.query({address:t});return(await Promise.all(e.map(async e=>{let n=await this.getClaimedAmount({user:t,contract:e.contract,chainKey:e.chainKey}),r=s.ih.fromBigInt(this.getRewardToken(e.chainKey),BigInt(e.accumulatedAmount)),i=[r.subtract(n)];return{accumulatedAmount:r,claimedAmount:n,rewardDistributor:{address:e.contract,chainKey:e.chainKey},pendingRewards:i,proof:e.proof,type:a.MERKLE_DROP,user:t}}))).filter(t=>!0)}async getClaimedAmount(t){let e=this.getRewardToken(t.chainKey),n=p.fg.connect(t.contract,this.providerFactory(t.chainKey)),r=await n.claimed(t.user);return s.ih.fromBigInt(e,r.toBigInt())}getRewardToken(t){return this.getDeployment(t).rewardToken}getDeployment(t){let e=this.config.deployments[t];if(e)return e;throw Error("No deployment found for chain ".concat(t))}constructor(t,e){this.config=t,this.providerFactory=e}}var U=n(83872);function z(t,e){return t.map(t=>{if("v1"===t.stargateVersion)return new y(t,U.I,h.m);if("v2"===t.stargateVersion)return new I(t,e,U.I,h.m);throw Error("Unknown stargate version ".concat(t.stargateVersion))})}function X(t,e,n){return t.map(t=>{if("v1"===t.stargateVersion)return new T.ny(t,e,U.I);if("v2"===t.stargateVersion)return new L(t,n.getConfig(t),U.I,h.m);throw Error("Unknown stargate version ".concat(t.stargateVersion))})}let M=[...d.xH,...u.n],x=z(M,c.Pp),V=[...d.SK.pools,...u.H.pools],Z=X(V,d.SK,u.H),G=function(t,e){let n=[];return t&&n.push(new C(t)),e&&n.push(new P(e)),n}({instant:{usdLimit:1e4},local:{minRemoteChainPathBalanceToIdealBalanceRatio:new s.gG(10,100)},remote:{}},{instant:{},local:{},remote:{}}),Q=function(t,e){let n=[new N(t,U.I)];for(let t of Object.values(e.deployments))n.push(new b(t,U.I));return n}(d.bQ,l.q);var H=n(50224);let Y=[...H.a],J=z(Y,c.Qp),W=[...H.q.pools],j=X(W,null,H.q);var $=n(8805),tt=n(2978);let te=[...tt.e],tn=z(te,c.Lv),tr=[...$.m.pools,...tt.p.pools],ti=X(tr,$.m,tt.p),to=n(23974).O.NEXT_PUBLIC_STAGE,ta=function(t){if("mainnet"===t)return V;if("testnet"===t)return tr;if("sandbox"===t)return W;throw Error("Unknown stage ".concat(t))}(to),ts=function(t){if("mainnet"===t)return Z;if("testnet"===t)return ti;if("sandbox"===t)return j;throw Error("Unknown stage ".concat(t))}(to),tc="mainnet"===to?G:[],td=function(t){if("mainnet"===t)return M;if("testnet"===t)return te;if("sandbox"===t)return Y;throw Error("Unknown stage ".concat(t))}(to),tl=function(t){if("mainnet"===t)return x;if("testnet"===t)return tn;if("sandbox"===t)return J;throw Error("Unknown stage ".concat(t))}(to),tu="mainnet"===to?Q:[]},8805:function(t,e,n){n.d(e,{m:function(){return i}});var r=n(24906);let i=new r.PA(r.$g)},49808:function(t,e,n){n.d(e,{m:function(){return o}});var r=n(93465),i=n(83872);let o=new r.gp(i.I)},8643:function(t,e,n){async function*r(t){let{onError:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new ReadableStream({start(n){Promise.all(t.map(async t=>{try{n.enqueue(await t)}catch(t){null==e||e(t)}})).finally(()=>n.close())}}).getReader();for(;;){let{done:t,value:e}=await n.read();if(t)return;yield e}}async function*i(t){let e=new ReadableStream({start(e){Promise.all(t.map(async t=>{for await(let n of t)e.enqueue(n)})).finally(()=>e.close())}}).getReader();for(;;){let{done:t,value:n}=await e.read();if(t)return;yield n}}n.d(e,{C:function(){return r},y:function(){return i}})},33221:function(t,e,n){n.d(e,{ny:function(){return A},Ki:function(){return i},Si:function(){return T},Ux:function(){return I}});var r,i,o=n(8590),a=n(8179),s=n(93465),c=n(51436),d=n(38214),l=n(5769),u=n(59825),h=n(8643),m=n(82805),p=n(84979);class y{static create(t){return new y(t)}createInput(t){return{mode:this.mode,srcAmount:this.srcAmount,dstAmount:this.dstAmount,dstPool:this.dstPool,fee:this.fee,srcAddress:t.srcAddress,dstAddress:t.dstAddress}}constructor(t){this.mode=i.REMOTE,this.srcAmount=t.srcAmount,this.dstAmount=t.dstAmount,this.fee=t.fee,this.dstPool=t.dstPool,this.estimatedDuration=t.estimatedDuration,this.meta=t.meta}}function g(t,e){return o.ih.fromRawAmount(t.token,e.multiply(BigInt(10)**BigInt(t.token.decimals)).divide(e.decimalScale).quotient)}function f(t,e,n){return t.multiply(e).divide(n)}let{getAddress:w}=d;function I(t){return t instanceof p.H}function T(t){return t instanceof m.P}(r=i||(i={})).INSTANT="instant",r.LOCAL="local",r.REMOTE="remote";class A{get routerContract(){let t=this.sdk.getRouterAddress(this.pool.chainKey);return c.Gh.connect(t,this.providerFactory(this.pool.chainKey))}get routerETHContract(){let t=this.sdk.getRouterEthAddress(this.pool.chainKey);return c.Sh.connect(t,this.providerFactory(this.pool.chainKey))}async getDeltaCredit(){let t=await this.poolContract.deltaCredit();return o.ih.fromBigInt(this.pool.lpToken,t.toBigInt())}async getTotalLiquidity(){let t=await this.poolContract.totalLiquidity();return o.ih.fromBigInt(this.pool.lpToken,t.toBigInt())}async getTotalSupply(){let t=await this.poolContract.totalSupply();return o.ih.fromBigInt(this.pool.lpToken,t.toBigInt())}async getBalance(t){return this.erc20.forToken(this.pool.lpToken).balanceOf(t.account)}getFeeLibraryAddress(){return this.poolContract.feeLibrary()}async getFeeLibraryContract(){let t=await this.getFeeLibraryAddress(),e=this.providerFactory(this.pool.chainKey);return c.Nv.connect(t,e)}supportsPool(t){return this.pool.address===t.address&&this.pool.chainKey===t.chainKey}async deposit(t){return(0,o.iI)(t.amount.token)?this.depositETH(t):this.depositERC20(t)}async depositERC20(t){let e=this.providerFactory(this.pool.chainKey),n=this.routerContract.populateTransaction.addLiquidity(this.pool.poolId,t.amount.quotient,t.dstAddress);return(0,s._X)(n,{provider:e,chainKey:this.pool.chainKey})}async depositETH(t){let e=this.providerFactory(this.pool.chainKey),n=t.amount.quotient,r=w(t.srcAddress),i=this.routerETHContract.populateTransaction.addLiquidityETH({from:r,value:n});return(0,s._X)(i,{provider:e,chainKey:this.pool.chainKey})}async redeemInstant(t){(0,a.Z)(t.srcAmount.token.equals(this.pool.lpToken),"Stargate: invalid currency");let e=this.providerFactory(this.pool.chainKey),n=this.pool.poolId,r=t.srcAmount.quotient,i=w(t.dstAddress),o=w(t.srcAddress),c=this.routerContract.populateTransaction.instantRedeemLocal(n,r,i,{from:o});return(0,s._X)(c,{provider:e,chainKey:this.pool.chainKey})}async redeemRemote(t){(0,a.Z)(t.srcAmount.token.equals(this.pool.lpToken),"Stargate: invalid currency");let e=this.providerFactory(this.pool.chainKey),[n,r]=await Promise.all([this.getTotalLiquidity(),this.getTotalSupply()]),i=this.pool.poolId,o=t.dstPool.poolId,c=t.dstPool.eid,d=w(t.srcAddress),l=t.srcAmount.quotient,u=f(t.srcAmount,n,r).quotient*BigInt(99)/BigInt(100),h=w(t.dstAddress),m=w(t.srcAddress),p=t.fee.nativeFee.quotient,y=this.routerContract.populateTransaction.redeemRemote(c,i,o,d,l,u,h,{dstGasForCall:0,dstNativeAddr:"0x",dstNativeAmount:0},{value:p,from:m});return(0,s._X)(y,{provider:e,chainKey:this.pool.chainKey})}async redeemLocal(t){(0,a.Z)(t.srcAmount.token.equals(this.pool.lpToken),"Stargate: invalid currency");let e=this.providerFactory(this.pool.chainKey),n=t.viaPool.eid,r=t.viaPool.poolId,i=this.pool.poolId,o=w(t.srcAddress),c=w(t.dstAddress),d=w(t.srcAddress),l=t.srcAmount.quotient,u=t.fee.nativeFee.quotient,h=this.routerContract.populateTransaction.redeemLocal(n,i,r,o,l,c,{dstGasForCall:0,dstNativeAddr:c,dstNativeAmount:0},{value:u,from:d});return(0,s._X)(h,{provider:e,chainKey:this.pool.chainKey})}redeem(t){if("local"===t.mode)return this.redeemLocal(t);if("remote"===t.mode)return this.redeemRemote(t);if("instant"===t.mode)return this.redeemInstant(t);throw Error("Unknown redeem type")}async getDepositedAmount(t){var e;let[n,r]=await Promise.all([this.getTotalLiquidity(),this.getTotalSupply()]),i=t.amount;return e=this.pool,(0,a.Z)(r.token.equals(e.lpToken),"LIQUIDITY"),(0,a.Z)(n.token.equals(e.lpToken),"LIQUIDITY"),(0,a.Z)(i.token.equals(e.lpToken),"LIQUIDITY"),g(e,n.multiply(i).divide(r))}async getLiquidityMinted(t){let e=t.amount,[n,r]=await Promise.all([this.getTotalLiquidity(),this.getTotalSupply()]),i=this.poolFee;return function(t,e,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(0,a.Z)(r.token.equals(t.token),"TOKEN"),(0,a.Z)(e.token.equals(t.lpToken),"LIQUIDITY"),(0,a.Z)(n.token.equals(t.lpToken),"LIQUIDITY");let c=o.ih.fromRawAmount(t.lpToken,r.multiply(BigInt(10)**BigInt(t.sharedDecimals)).divide(r.decimalScale).quotient).quotient;if(s){let t=c*i.mintFeeRate.numerator/i.mintFeeRate.denominator;c-=t}let d=c;return e.quotient!==BigInt(0)&&(d=c*e.quotient/n.quotient),o.ih.fromRawAmount(t.lpToken,d)}(this.pool,r,n,e,i,!1)}async getRedeemOptionsLocal(t){let e=this.pool,n=this.sdk.getActiveLinks().filter(t=>t.srcPool===e).map(t=>t.dstPool).map(e=>this.getRedeemOptionLocal(t,e));return(0,h.C)(n)}async getRedeemOptionLocal(t,e){var n,r;let[i,s,c,d]=await Promise.all([this.getChainPath(e,this.pool,this.pool.lpToken),this.getTotalSupply(),this.getTotalLiquidity(),this.getRedeemLocalMessageFee(e)]),l=t.amount,h=function(t,e,n,r,i){(0,a.Z)(n.token.equals(t.lpToken),"LIQUIDITY"),(0,a.Z)(r.token.equals(t.lpToken),"LIQUIDITY"),(0,a.Z)(i.token.equals(t.lpToken),"LIQUIDITY");let o=i.multiply(r).divide(n),s=e.lkb.add(e.credit);o.quotient>=s.quotient&&(o=s);let c=o.multiply(n).divide(r);return{amountLD:g(t,o),amountLP:c}}(this.pool,i,s,c,l),m=h.amountLP,y=h.amountLD,f=(n=o.ih.fromBigInt(this.pool.lpToken,BigInt(0)),r=i.balance.subtract(m),n.greaterThan(r)?n:r),w=i.idealBalance.equalTo(0)?k:new o.gG(i.balance.toBigInt(),i.idealBalance.toBigInt()),I=i.idealBalance.equalTo(0)?k:new o.gG(f.toBigInt(),i.idealBalance.toBigInt()),T={remotePath:i,totalSupply:s,totalLiquidity:c,remoteChainPathBalance:i.balance,remoteChainPathBalanceAfterRedeem:f,remoteChainPathBalanceToIdealBalance:w,remoteChainPathBalanceToIdealBalanceAfterRedeem:I},[A,v]=await Promise.all([u.k.getDuration({srcChainKey:this.pool.chainKey,dstChainKey:e.chainKey}),u.k.getDuration({srcChainKey:e.chainKey,dstChainKey:this.pool.chainKey})]);return p.H.create({srcAmount:m,dstAmount:y,fee:d,viaPool:e,estimatedDuration:A+v,meta:T})}async getRedeemOptionsRemote(t){let e=this.sdk.getActiveLinks().filter(t=>t.srcPool===this.pool).map(t=>t.dstPool).map(e=>this.getRedeemOptionRemote(t,e));return(0,h.C)(e)}async getRedeemOptionInstant(t){var e;let n,r;let i=t.amount,[s,c,d]=await Promise.all([this.getTotalLiquidity(),this.getTotalSupply(),this.getDeltaCredit()]),{amountLP:l,amountLD:u}=(e=this.pool,(0,a.Z)(c.token.equals(e.lpToken),"LIQUIDITY"),(0,a.Z)(s.token.equals(e.lpToken),"LIQUIDITY"),(0,a.Z)(d.token.equals(e.lpToken),"LIQUIDITY"),(0,a.Z)(i.token.equals(e.lpToken),"LIQUIDITY"),n=i,r=i.multiply(s).divide(c),d.quotient<=r.quotient&&(n=(r=d).multiply(c).divide(s)),{amountLD:g(e,r=n.multiply(s).divide(c)),amountLP:n}),h=(0,o.JK)(this.pool.chainKey),p={nativeFee:o.ih.fromBigInt(h,BigInt(0)),zroFee:o.ih.fromBigInt(h,BigInt(0))},y=d.subtract(l),f=new o.gG(l.quotient,d.quotient);return m.P.create({srcAmount:l,dstAmount:u,fee:p,estimatedDuration:1,meta:{deltaCredit:d,totalLiquidity:s,totalSupply:c,deltaCreditAfterRedeem:y,deltaCreditRedeemedPercent:f}})}async getRedeemOptions(t){let[e,n,r]=await Promise.all([(0,h.C)([this.getRedeemOptionInstant(t)]),this.getRedeemOptionsRemote(t),this.getRedeemOptionsLocal(t)]);return(0,h.y)([e,r,n])}async getAllowance(t){let e=this.pool.token;return(0,o.hD)(e)?this.erc20.forToken(e).allowance(t.account,this.routerContract.address):o.ih.fromBigInt(e,o.Bz)}approve(t){return this.erc20.forToken(this.pool.token).approve(t.amount,this.routerContract.address)}async getChainPath(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.lpToken,r=c.RX.connect(t.address,this.providerFactory(t.chainKey)),i=await r.getChainPath(e.eid,e.poolId),a=t=>o.ih.fromBigInt(n,t.toBigInt());return{srcChainKey:t.chainKey,srcChainId:t.eid,srcPoolId:e.poolId,dstChainKey:e.chainKey,dstChainId:e.eid,dstPoolId:e.poolId,balance:a(i.balance),credit:a(i.credits),idealBalance:a(i.idealBalance),lkb:a(i.lkb),ready:i.ready,weight:i.weight.toNumber()}}async getRedeemOptionRemote(t,e){let n=t.amount,r=this.pool,[i,a,s,c,d]=await Promise.all([this.getFeeLibraryContract(),this.getTotalLiquidity(),this.getTotalSupply(),this.getChainPath(this.pool,e),this.getRedeemRemoteMessageFee(e)]);f(n,a,s);let h=c.balance.multiply(s).divide(a),m=n.greaterThan(h)?h:n,p=f(m,a,s),w=l.d,I=await i.getFees(r.poolId,e.poolId,e.eid,w,p.quotient),T=t=>o.ih.fromBigInt(n.token,t.toBigInt()),A={eqFee:T(I.eqFee),eqReward:T(I.eqReward),lpFee:T(I.lpFee),protocolFee:T(I.protocolFee)};p.subtract(A.lpFee).add(A.eqReward);let k=g(e,p.subtract(A.protocolFee).subtract(A.lpFee).subtract(A.eqFee).add(A.eqReward)),v=await u.k.getDuration({srcChainKey:r.chainKey,dstChainKey:e.chainKey});return y.create({srcAmount:m,dstAmount:k,fee:d,dstPool:e,estimatedDuration:v,meta:{chainPath:c,isSrcPoolDisabled:this.pool.disabled,isDstPoolDisabled:e.disabled}})}async getRedeemLocalMessageFee(t){let e=await this.getRedeemRemoteMessageFee(t),n=new o.gG(130,100);return{nativeFee:e.nativeFee.multiply(n),zroFee:e.zroFee}}async getRedeemRemoteMessageFee(t){let e=(0,o.JK)(this.pool.chainKey),n=t.eid,r=s.IP,[i,a]=await this.routerContract.quoteLayerZeroFee(n,4,r,"0x",{dstGasForCall:0,dstNativeAddr:"0x",dstNativeAmount:0});return{nativeFee:o.ih.fromBigInt(e,i.toBigInt()),zroFee:o.ih.fromBigInt(e,a.toBigInt())}}constructor(t,e,n,r=new s.gp(n)){this.pool=t,this.sdk=e,this.providerFactory=n,this.erc20=r,this.poolFee={mintFeeRate:new o.iA(0,1e3)},this.poolContract=c.RX.connect(this.pool.address,n(this.pool.chainKey))}}let k=new o.gG(0,100)},82805:function(t,e,n){n.d(e,{P:function(){return i}});var r=n(33221);class i{static create(t){return new i(t)}createInput(t){return{mode:this.mode,srcAmount:this.srcAmount,dstAmount:this.dstAmount,srcAddress:t.srcAddress,dstAddress:t.dstAddress}}constructor(t){this.mode=r.Ki.INSTANT,this.srcAmount=t.srcAmount,this.dstAmount=t.dstAmount,this.fee=t.fee,this.meta=t.meta,this.estimatedDuration=t.estimatedDuration}}},84979:function(t,e,n){n.d(e,{H:function(){return i}});var r=n(33221);class i{static create(t){return new i(t)}createInput(t){return{mode:this.mode,srcAmount:this.srcAmount,dstAmount:this.dstAmount,viaPool:this.viaPool,fee:this.fee,srcAddress:t.srcAddress,dstAddress:t.dstAddress}}constructor(t){this.mode=r.Ki.LOCAL,this.srcAmount=t.srcAmount,this.dstAmount=t.dstAmount,this.fee=t.fee,this.viaPool=t.viaPool,this.estimatedDuration=t.estimatedDuration,this.meta=t.meta}}}}]);